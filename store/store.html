<!DOCTYPE html>
<html lang="en">

<head>
    <title>A simple dapp to store and call your value</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <script src="https://cdn.ethers.io/lib/ethers-5.2.umd.min.js" type="application/javascript"></script>
    <script language="javascript" type="text/javascript" src="newstore_abi.js"></script>
</head>

<body>
    <a href="../index.html">Home page</a>
    <h2>Enter a number here and click Set number and get your number gy clicking get Number </h2>
    <button id="connectButton">Connect</button>

    <button id="get">Get Number</button>

    <div id="result">
        <p id="getNumber"></p>
    </div>
    <div class="form">
        <label for="numField">Enter a number you want to store on the blockchain: </label>
        <input type="text" name="takeNumber" id="takeNumber">
        <p id="setNumber"></p>
        <button id="set">Set Number</button>
    </div>


    <script>
        const myNum = document.getElementById('takeNumber');

        const connectButton = document.querySelector('#connectButton');
        connectButton.addEventListener('click', connect);

        const setButton = document.querySelector('#set');
        setButton.addEventListener('click', set);

        const getButton = document.querySelector('#get');
        getButton.addEventListener('click', get);

        const getNumber = document.getElementById('getNumber');
        const setNumber = document.getElementById('setNumber');

        //  const contractAddress = '0xb97295dec47914a81c80c6007e6cd8daa2af8326';
        const contractAddress = '0xaa493310e851d77e1bf565fefa9643db8170a92a';
        //  const abi = storeABI;
        const abi = newStoreABI;
        const provider = new ethers.providers.Web3Provider(window.ethereum);
        const signer = provider.getSigner();

        const contract = new ethers.Contract(contractAddress, abi, signer);




        async function connect() {
            if (typeof window.ethereum !== 'undefined') {
                console.log("We see metamask");
                ethereum.request({ method: "eth_requestAccounts" });
                connectButton.textContent = 'Connected';
            }
        }

        async function get() {
            try {
                const getNum = await contract.favoriteNumber();
                console.log(getNum);

                getNumber.textContent = 'My Number is: ' + getNum;

            } catch (error) {
                console.log(error)

            }
        }

        get();


        async function set() {
            try {

                const setNum = await contract.store(Number(myNum.value));
                await setNum.wait();
                const newNum = await contract.favoriteNumber();
                setNumber.textContent = 'My Number is: ' + newNum;

            } catch (error) {
                console.log(error);

            }

        }
    </script>



</body>

</html>